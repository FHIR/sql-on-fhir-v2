{
  "$id": "https://sql-on-fhir.org/ig/tests",
  "title": "SQL on FHIR tests schema",
  "description": "Standard format for JSON test definitions used to validate SQL on FHIR view runner implementations.",
  "type": "object",
  "required": [
    "title",
    "resources",
    "tests"
  ],
  "properties": {
    "title": {
      "type": "string",
      "description": "The name of the test suite."
    },
    "description": {
      "type": "string",
      "description": "A description of the test suite."
    },
    "allowExtendedFhirpath": {
      "type": "boolean",
      "description": "If true, the test runner should allow the use of FHIRPath functions outside of the restricted subset defined in the specification."
    },
    "authors": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "The authors of the test suite."
    },
    "generated": {
      "type": "boolean",
      "description": "If true, the test suite was generated by a tool and should not be edited directly."
    },
    "resources": {
      "type": "array",
      "items": {
        "type": "object"
      },
      "description": "A list of FHIR resources that are used in the tests. There can be multiple different resource types in the list. Each should be a valid FHIR resource."
    },
    "tests": {
      "type": "array",
      "description": "A list of tests to run against the view.",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": [
          "title",
          "view"
        ],
        "oneOf": [
          {
            "required": [
              "expect"
            ]
          },
          {
            "required": [
              "expectCount"
            ]
          },
          {
            "required": [
              "expectError"
            ]
          }
        ],
        "properties": {
          "title": {
            "type": "string",
            "description": "The name of the test."
          },
          "description": {
            "type": "string",
            "description": "A description of the test."
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "A list of tags that can be used to categorize this test."
          },
          "view": {
            "type": "object",
            "description": "The view to run the test against."
          },
          "expect": {
            "type": "array",
            "description": "The expected result of the test. Each object within the array represents a row in the result set, with column names as keys.",
            "items": {
              "type": "object"
            }
          },
          "expectCount": {
            "type": "number",
            "description": "The expected number of rows in the result."
          },
          "expectError": {
            "type": "boolean",
            "description": "If true, the test is expected to throw an error."
          },
          "expectColumns": {
            "type": "array",
            "description": "The expected columns in the result set.",
            "items": {
              "type": "string"
            },
            "minItems": 1
          }
        }
      }
    }
  }
}
