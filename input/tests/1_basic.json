{
   "desc": " Trivial view definitions ",
   "name": "basic views",
   "resource": [
      {
         "birthDate": "1951",
         "id": "pt1",
         "name": [
            {
               "family": "F1.1",
               "given": [
                  "G1.1.1",
                  "G1.1.2"
               ]
            },
            {
               "family": "F1.2",
               "given": [
                  "G1.2.1",
                  "G1.2.2"
               ],
               "use": "official"
            }
         ],
         "resourceType": "Patient"
      },
      {
         "birthDate": "1952",
         "id": "pt2",
         "name": [
            {
               "family": "F2.1",
               "given": [
                  "G2.1.1",
                  "G2.1.2"
               ],
               "use": "official"
            },
            {
               "family": "F2.2",
               "given": [
                  "G2.2.1",
                  "G2.2.2"
               ]
            }
         ],
         "resourceType": "Patient"
      },
      {
         "address": [
            {
               "city": "C3"
            }
         ],
         "birthDate": "1953",
         "id": "pt3",
         "name": [
            {
               "family": "F3.1",
               "given": [
                  "G3.1.1",
                  "G3.1.2"
               ]
            },
            {
               "family": "F3.2",
               "given": [
                  "G3.2.1",
                  "G3.2.2"
               ],
               "use": "official"
            }
         ],
         "resourceType": "Patient"
      }
   ],
   "views": [
      {
         "desc": "",
         "result": [
            {
               "bod": "1951",
               "id": "pt1"
            },
            {
               "bod": "1951",
               "id": "pt1"
            },
            {
               "bod": "1951",
               "id": "pt1"
            }
         ],
         "title": "basic query",
         "view": {
            "resource": "Patient",
            "select": [
               {
                  "expression": "id",
                  "name": "id"
               },
               {
                  "expression": "birthDate",
                  "name": "bod"
               }
            ]
         }
      },
      {
         "desc": "You can use `first()` function to select first element in path",
         "result": [
            {
               "first_name": "G1.1.1",
               "id": "pt1",
               "last_name": "F1.1",
               "name": "1951"
            },
            {
               "first_name": "G2.1.1",
               "id": "pt2",
               "last_name": "F2.1",
               "name": "1952"
            },
            {
               "first_name": "G3.1.1",
               "id": "pt3",
               "last_name": "F3.1",
               "name": "1953"
            }
         ],
         "title": "first()",
         "view": {
            "resource": "Patient",
            "select": [
               {
                  "expression": "id",
                  "name": "id"
               },
               {
                  "expression": "birthDate",
                  "name": "bod"
               },
               {
                  "expression": "name.family.first()",
                  "name": "last_name"
               },
               {
                  "expression": "name.given.first()",
                  "name": "first_name"
               }
            ]
         }
      },
      {
         "desc": "If expression returns array of results, it's recommended to return this array",
         "result": [
            {
               "first_name": [
                  "G1.1.1",
                  "G1.1.2",
                  "G1.2.1",
                  "G1.2.2"
               ],
               "id": "pt1",
               "last_name": [
                  "F1.1",
                  "F1.2"
               ],
               "name": "1951"
            },
            {
               "first_name": [
                  "G2.1.1",
                  "G2.1.2",
                  "G2.2.1",
                  "G2.2.2"
               ],
               "id": "pt2",
               "last_name": [
                  "F2.1",
                  "F2.2"
               ],
               "name": "1952"
            },
            {
               "first_name": [
                  "G3.1.1",
                  "G3.1.2",
                  "G3.2.1",
                  "G3.2.2"
               ],
               "id": "pt3",
               "last_name": [
                  "F3.1",
                  "F3.2"
               ],
               "name": "1953"
            }
         ],
         "title": "expression returns array",
         "view": {
            "resource": "Patient",
            "select": [
               {
                  "expression": "id",
                  "name": "id"
               },
               {
                  "expression": "birthDate",
                  "name": "bod"
               },
               {
                  "expression": "name.family",
                  "name": "last_name"
               },
               {
                  "expression": "name.given",
                  "name": "first_name"
               }
            ]
         }
      },
      {
         "desc": "If expression returns object of results, it's recommended to return this array",
         "result": [
            {
               "id": "pt1",
               "name": {
                  "family": "F1.1",
                  "given": [
                     "G1.1.1",
                     "G1.1.2"
                  ]
               }
            },
            {
               "id": "pt1",
               "name": {
                  "family": "F1.1",
                  "given": [
                     "G1.1.1",
                     "G1.1.2"
                  ]
               }
            },
            {
               "id": "pt1",
               "name": {
                  "family": "F1.1",
                  "given": [
                     "G1.1.1",
                     "G1.1.2"
                  ]
               }
            }
         ],
         "title": "expression returns object",
         "view": {
            "resource": "Patient",
            "select": [
               {
                  "expression": "id",
                  "name": "id"
               },
               {
                  "expression": "name.first()",
                  "name": "name"
               }
            ]
         }
      },
      {
         "desc": "if expression returns empty set - return NULL in columns",
         "result": [
            {
               "city": null,
               "id": "pt1"
            },
            {
               "city": null,
               "id": "pt2"
            },
            {
               "city": "C3",
               "id": "pt3"
            }
         ],
         "title": "empty as nulls",
         "view": {
            "resource": "Patient",
            "select": [
               {
                  "expression": "id",
                  "name": "id"
               },
               {
                  "expression": "address.city.first()",
                  "name": "city"
               }
            ]
         }
      },
      {
         "desc": "To filter specific elements of array you can use where expression",
         "result": [
            {
               "id": "pt1",
               "ln": "F1.2"
            },
            {
               "id": "pt2",
               "ln": "F2.1"
            },
            {
               "id": "pt3",
               "ln": "F3.2"
            }
         ],
         "title": "filter with where",
         "view": {
            "resource": "Patient",
            "select": [
               {
                  "expression": "id",
                  "name": "id"
               },
               {
                  "expression": "name.where(use='official').family.first()",
                  "name": "ln"
               }
            ]
         }
      }
   ]
}
